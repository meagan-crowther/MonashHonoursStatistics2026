<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Joshua F. Wiley">
<meta name="dcterms.date" content="2026-02-19">

<title>Generalized Linear Models 2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="interpretting_residual_diagnostics_files/libs/clipboard/clipboard.min.js"></script>
<script src="interpretting_residual_diagnostics_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="interpretting_residual_diagnostics_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="interpretting_residual_diagnostics_files/libs/quarto-html/popper.min.js"></script>
<script src="interpretting_residual_diagnostics_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="interpretting_residual_diagnostics_files/libs/quarto-html/anchor.min.js"></script>
<link href="interpretting_residual_diagnostics_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="interpretting_residual_diagnostics_files/libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="interpretting_residual_diagnostics_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="interpretting_residual_diagnostics_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="interpretting_residual_diagnostics_files/libs/bootstrap/bootstrap-caa39ac4752d7679cb6760a76ea4f73a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Generalized Linear Models 2</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Joshua F. Wiley </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 19, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="setup" class="level1">
<h1>Setup</h1>
<p>You can download the <code>R</code>markdown file for this content from the GitHub folder for this unit.</p>
<p>We will be using a few packages for this content and also the baseline data only from the data collection exercise.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">digits =</span> <span class="dv">3</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(data.table)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(JWileymisc)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggpubr)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="simulated-examples-where-assumptions-met" class="level1">
<h1>Simulated Examples where Assumptions Met</h1>
<p>This section has three examples. Here is a simulated (made up) example where we make up data that perfectly meets all assumptions. Simulating data is helpful because it allows us to create data that meets the assumptions of a linear model. So we can see what diagnostics look like in a “perfect world”.</p>
<p>There are a few aspects worth noting.</p>
<ol type="1">
<li>Note that in the large sample size example, there are some “extreme values”. This is because by default <code>modelDiagnostics()</code> flags extreme values as based on the extremes of an expected normal distribution. However, if you say that, for example, the bottom and top half percentile of a normal distribution is extreme, with a large sample size, there will be some extreme values, even in perfectly normal data. That does not necessarily mean they need to be excluded. In the graphs we can see that no point is very far from any other point. Nothing really seems “wrong” or “problematic” about them. They are just the points that happen to be the most extreme, and there are just a few.</li>
<li>In the large sample size, the predicted and residuals plot looks “perfect”. All lines are basically parallel and flat. The dots are “noisy” with no clear pattern.</li>
<li>In the moderate sample size, there are a few extreme values identified on the low end of residuals. Again they are not that far from other points. If we did not simulate the data, we might consider excluding them. Since we did simulate the data, we know that these points are actually no different than the rest – they were all made and drawn randomly from a normal distribution. This shows what random chance can do.</li>
<li>In the moderate sample size predicted vs residual plot, because there are just a few data points with lower predicted values, there is not much data on the left hand side of the plot. The median and 10th and 90th percentile lines (blue lines) “flex” to match the data in the left hand side. Because there are just a couple of values, and these values by chance (random) happen to have lower residuals, all the blue lines curve down. In fact, I would not be worried about this. When I interpret this kind of plot and am looking for the homogeneity of variance assumption, I focus on areas where there is more data. Note how when you look at the scatter plot, the point where the blue lines begin really curving / changing from straight is the same point that there is a drop off in the density (the number) of data points. Usually, data becomes less dense at left or right hand side, so often you need to focus on the middle. However, that does not have to be the case. For example, in a bimodal distribution, you could have the lowest density of data in the middle.</li>
<li>Finally, in the small sample size, the predicted vs residuals plot has only few data points on the far right side, and again by random chance, their residuals are all pretty small, so the blue lines curve inwards and there is apparently less variability at the right hand side (i.e., high predicted values). Again, I would not be worried about this. I would focus on the areas where there is more data. The right hand side has too few data points to be stable.</li>
</ol>
<section id="large-sample-size-n-2000" class="level2">
<h2 class="anchored" data-anchor-id="large-sample-size-n-2000">Large Sample Size (N = 2000)</h2>
<div class="cell" data-fig.fullwidth="true">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>d1 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">2000</span>))</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>d1[, y <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">2000</span>)]</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> d1)</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">modelDiagnostics</span>(m1), <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interpretting_residual_diagnostics_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption>Large sample size, simulated so assumptions perfectly met.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="moderate-sample-size-n-200" class="level2">
<h2 class="anchored" data-anchor-id="moderate-sample-size-n-200">Moderate Sample Size (N = 200)</h2>
<div class="cell" data-fig.fullwidth="true">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>d2 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">200</span>))</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>d2[, y <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">200</span>)]</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> d2)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">modelDiagnostics</span>(m2), <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interpretting_residual_diagnostics_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption>Moderate sample size, simulated so assumptions perfectly met.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="small-sample-size-n-50" class="level2">
<h2 class="anchored" data-anchor-id="small-sample-size-n-50">Small Sample Size (N = 50)</h2>
<div class="cell" data-fig.fullwidth="true">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>d3 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">50</span>))</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>d3[, y <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">50</span>)]</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> d3)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">modelDiagnostics</span>(m3), <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interpretting_residual_diagnostics_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption>Moderate sample size, simulated so assumptions perfectly met.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="simulated-examples-where-data-not-normal" class="level1">
<h1>Simulated Examples where Data Not Normal</h1>
<p>Here is a simulated (made up) example where we make up data that is not normal. So the normality assumption should not be met. However, the data are not generated to have different residual variances, so we should see more or less that the residual variance is homogenous assumption is met.</p>
<p>Some notes on the plots.</p>
<ol type="1">
<li>In the large sample size, we can clearly see the non normality of the residuals in the left plot. It is not “terrible”, but note how all the extreme values are on one side, the right hand side of the left plot. That comes from a long right tail.</li>
<li>In the large sample size, the predicted vs residuals plot looks fine. The blue lines are all parallel and flat. The dots are “noisy” with no clear pattern.</li>
<li>In the moderate sample size, we can again see although its a bit harder to tell, that the data are not normally distributed. It is a bit harder especially as one might wonder if there are just a couple of extreme values and if you took those out, if the data would be pretty normally distributed. This happens when there is a long right tail, but with a small sample size, the “tail” may only comprise a few data points, so telling a genuinely long tail from a few extreme values or outliers can be challenging. In this case we simulated the data so we know these are non normal data, not outliers. But in practice, you could not really distinguish easily.</li>
<li>In the moderate sample size, the predicted vs residuals looks mostly okay, but the left hand side of that plot again now has fewer data points (ie few negative predicted values) and so the blue lines are unstable, they curve to match the handful of data points present at negative predicted values. However, if you focus on where most data points exist, the high density regions, the spread is roughly even, the lines roughly flat. This matches what we know which is the data were simulated with a homogenous residual variance.</li>
<li>In the small sample size, again the data look not very normally distributed.</li>
<li>In the small sample size, the predicted vs residuals plot has only few data points on the far right side, and again by random chance, their residuals are all pretty small, so the blue lines curve inwards and there is apparently less variability at the right hand side (i.e., high predicted values). Again, I would not be worried about this. I would focus on the areas where there is more data. The right hand side has too few data points to be stable.</li>
</ol>
<section id="large-sample-size-n-2000-1" class="level2">
<h2 class="anchored" data-anchor-id="large-sample-size-n-2000-1">Large Sample Size (N = 2000)</h2>
<div class="cell" data-fig.fullwidth="true">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>e1 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">2000</span>))</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>e1[, y <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> x <span class="sc">+</span> (<span class="fl">1.5</span><span class="sc">^</span><span class="fu">rnorm</span>(<span class="dv">2000</span>))]</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> e1)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">modelDiagnostics</span>(n1), <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interpretting_residual_diagnostics_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption>Large sample size, simulated so not normal.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="moderate-sample-size-n-200-1" class="level2">
<h2 class="anchored" data-anchor-id="moderate-sample-size-n-200-1">Moderate Sample Size (N = 200)</h2>
<div class="cell" data-fig.fullwidth="true">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>e2 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">200</span>))</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>e2[, y <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> x <span class="sc">+</span> (<span class="fl">1.5</span><span class="sc">^</span><span class="fu">rnorm</span>(<span class="dv">200</span>))]</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>n2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> e2)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">modelDiagnostics</span>(n2), <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interpretting_residual_diagnostics_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption>Moderate sample size, simulated so not normal.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="small-sample-size-n-50-1" class="level2">
<h2 class="anchored" data-anchor-id="small-sample-size-n-50-1">Small Sample Size (N = 50)</h2>
<div class="cell" data-fig.fullwidth="true">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>e3 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">50</span>))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>e3[, y <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> x <span class="sc">+</span> (<span class="fl">1.5</span><span class="sc">^</span><span class="fu">rnorm</span>(<span class="dv">50</span>))]</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>n3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> e3)</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">modelDiagnostics</span>(n3), <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interpretting_residual_diagnostics_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption>Small sample size, simulated so not normal.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="simulated-examples-where-data-not-homogenous" class="level1">
<h1>Simulated Examples where Data Not Homogenous</h1>
<p>Here is a simulated (made up) example where we make up data that is normally distributed. However, the residual variance is not homogenous. Instead, the residual variance actually increases with the predictor, x. So this means that the homogeneity of variance assumption is violated.</p>
<p>Here are notes on these.</p>
<ol type="1">
<li>In the large sample size, even though the data are normally distributed, the residual plot on the left looks quite not normal. It is basically symmetrical, but peaked quite differently from a normal distribution. What is happening is that the residuals, while being normally distributed, each come from normal distributions with different variances. If we do not model or account for that, the residuals will not appear normal.</li>
<li>In the large sample size, the predicted vs residuals plot very clearly shows a funnel shape. This is clearly present in both the data (the points) and the blue lines draw our eyes to that shape. While there definitely are fewer data points at high predicted values, where the variance seems to be much greater, it is not only 2-3 data points. There are quite a few. If you look at predicted values above 2.29, you can start to see the variance increasing already. This would be a clear case of non homogenous variance.</li>
<li>We see basically the same pattern for both plots with the modreate sample size.</li>
<li>In the small sample size, probably partly due to chance, everything actually looks much better. Even though we used the same simulation process, the random sample we got this time is not as varied in the residual variance, so the residuals seem to be better fit by one normal distribution, and the predicted vs residual plots are not as clearly funnel shaped. We can see it does widen out on the right hand side, but without knowing that the simulated data were doing that, there are so few data points at the high predicted values we may not be confident and may assume an approximately homogenous variance.</li>
</ol>
<section id="large-sample-size-n-2000-2" class="level2">
<h2 class="anchored" data-anchor-id="large-sample-size-n-2000-2">Large Sample Size (N = 2000)</h2>
<div class="cell" data-fig.fullwidth="true">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>f1 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">2000</span>))</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>f1[, y <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> x <span class="sc">+</span> (<span class="fu">rnorm</span>(<span class="dv">2000</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">pmin</span>(<span class="fu">exp</span>(x), <span class="dv">10</span>)))]</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>o1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> f1)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">modelDiagnostics</span>(o1), <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interpretting_residual_diagnostics_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption>Large sample size, simulated so not homogenous.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="moderate-sample-size-n-200-2" class="level2">
<h2 class="anchored" data-anchor-id="moderate-sample-size-n-200-2">Moderate Sample Size (N = 200)</h2>
<div class="cell" data-fig.fullwidth="true">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>f2 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">200</span>))</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>f2[, y <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> x <span class="sc">+</span> (<span class="fu">rnorm</span>(<span class="dv">200</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">pmin</span>(<span class="fu">exp</span>(x), <span class="dv">10</span>)))]</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>o2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> f2)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">modelDiagnostics</span>(o2), <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interpretting_residual_diagnostics_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption>Moderate sample size, simulated so not homogenous.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="small-sample-size-n-50-2" class="level2">
<h2 class="anchored" data-anchor-id="small-sample-size-n-50-2">Small Sample Size (N = 50)</h2>
<div class="cell" data-fig.fullwidth="true">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>f3 <span class="ot">&lt;-</span> <span class="fu">data.table</span>(<span class="at">x =</span> <span class="fu">rnorm</span>(<span class="dv">50</span>))</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>f3[, y <span class="sc">:</span><span class="er">=</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> x <span class="sc">+</span> (<span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fu">pmin</span>(<span class="fu">exp</span>(x), <span class="dv">10</span>)))]</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>o3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> f3)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">modelDiagnostics</span>(o3), <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interpretting_residual_diagnostics_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption>Small sample size, simulated so not homogenous.</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="real-examples" class="level1">
<h1>Real Examples</h1>
<p>Now we will look at some real data examples.</p>
<section id="daily-positive-affect" class="level2">
<h2 class="anchored" data-anchor-id="daily-positive-affect">Daily Positive Affect</h2>
<p>Here is some real data from the <code>aces_daily</code> dataset. The outcome is daily positive affect. This is averaged so the scale goes from 1 to 5. The residuals look quite normally distributed. When we look at predicted vs residuals plot, the upper 90th percentil looks basically flat. The median (solid blue line) is also basically flat. The 10th percentile line is not flat. This is a classic pattern that occurs when their is a floor effect in a distribution. That is, lots of people have positive affect values near 1, the lowest possible. As the regression model predicts lower scores, the residuals CANNOT be negative. For example, since values cannot go below 1, if the predicted value is 0.5, all residuals will have to be positive. Conversely for predicted values around 3, residuals can be positive or negative. This floor may cause some non homogenous variance as well.</p>
<p>There will not be any “easy” ways to fix this. Either we would need a different measure of positive affect that does not experience floor effects. Or we would need to change the regression model somehow so that it never predicts too low values.</p>
<div class="cell" data-fig.fullwidth="true">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(aces_daily)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>aces_daily <span class="ot">&lt;-</span> <span class="fu">as.data.table</span>(aces_daily)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>r1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(PosAff <span class="sc">~</span> STRESS <span class="sc">+</span> SUPPORT <span class="sc">+</span> Age, <span class="at">data =</span> aces_daily)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">modelDiagnostics</span>(r1), <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interpretting_residual_diagnostics_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption>Daily Positive Affect.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="daily-negative-affect" class="level2">
<h2 class="anchored" data-anchor-id="daily-negative-affect">Daily Negative Affect</h2>
<p>Here is some real data from the <code>aces_daily</code> dataset. The outcome is daily negative affect. This is averaged so the scale goes from 1 to 5. This has an even more extreme floor effect than does positive affect. It is a bit hard to tell as there is a lot of data, but essentially many people have negative affect scores near 1, which is about the lowest predicted value, and so they end up with residuals near 0. The residual distribution is spiked near 0 because of all these, and we see the variance of residuals is smaller at low than high predicted values. Again because when the predicted value is 1.03 (the lowest predicted value), the residuals can at most be -0.03. And all other residuals would be 0, or some positive number.</p>
<div class="cell" data-fig.fullwidth="true">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(NegAff <span class="sc">~</span> STRESS <span class="sc">+</span> SUPPORT <span class="sc">+</span> Age, <span class="at">data =</span> aces_daily)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">modelDiagnostics</span>(r2), <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interpretting_residual_diagnostics_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption>Daily Negative Affect.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="age-years" class="level2">
<h2 class="anchored" data-anchor-id="age-years">Age (Years)</h2>
<p>Here is some real data from the <code>aces_daily</code> dataset. The outcome is age in years. Predictors are EDU and BornAUS, two binary variables. The residuals look quite normally distributed. When we look at predicted vs residuals plot, it is being treated as a bit discrete, because with two binary predictors, there are only four possible predicted values. In this case, the diamonds are the 10th and 90th percentiles. The blue dots are the medians. Here we can see that there is a bit less variability for higher predicted values, although its not too different.</p>
<div class="cell" data-fig.fullwidth="true">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>baseline <span class="ot">&lt;-</span> aces_daily[<span class="sc">!</span><span class="fu">duplicated</span>(UserID)]</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>r3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Age <span class="sc">~</span> EDU <span class="sc">+</span> BornAUS, <span class="at">data =</span> baseline)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">modelDiagnostics</span>(r3), <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interpretting_residual_diagnostics_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption>Age with categorical predictors only.</figcaption>
</figure>
</div>
</div>
</div>
<p>Here we add some more predictors including a continuous predictor, SES, so that there is some more variation in the predicted values. We continue to see a pretty normally distributed residuals. The predicted versus residual plot potentially indicates a bit of variation, but now with less data, since age is not daily, it is not the easiest to tell. There may be a bit less variation at both low and high predicted values. In this case note that for lower predicted ages, around 19.9 years, it is not only 2 or 3 data points, there are a range of predicted values around that, making the idea that its just very unstable due to few data points a less clear explanation, unlike what we saw in some of the earlier simulated examples.</p>
<div class="cell" data-fig.fullwidth="true">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>r4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Age <span class="sc">~</span> EDU <span class="sc">*</span> BornAUS <span class="sc">*</span> Female <span class="sc">+</span> SES_1, <span class="at">data =</span> baseline)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">modelDiagnostics</span>(r4), <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interpretting_residual_diagnostics_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption>Age with categorical and continuous predictors.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="miles-per-gallon" class="level2">
<h2 class="anchored" data-anchor-id="miles-per-gallon">Miles Per Gallon</h2>
<p>Here is some miles per gallon data from the <code>mtcars</code> dataset. It is quite a small dataset, with 32 observations.</p>
<p>The residuals do not look very normally distributed. The predicted versus quantile graph, the blue lines seem to be quite curved. However, there is very little data.</p>
<div class="cell" data-fig.fullwidth="true">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>r5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> hp <span class="sc">+</span> qsec, <span class="at">data =</span> mtcars)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">modelDiagnostics</span>(r5), <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interpretting_residual_diagnostics_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption>miles per gallon.</figcaption>
</figure>
</div>
</div>
</div>
<p>If the blue lines are not helping interpretation or make it hard to see the raw data ever, we can suppress them by setting <code>quantiles = FALSE</code> in <code>modelDiagnostics()</code>. This will show the raw data only.</p>
<p>Because there is less data, it can be hard to judge precisely. For example, at a predicted values of 7.04, the lowest predicted value, there is only one data point. In a way, one could say, well at that point, since there is only one value, the 10th and 90th percentiles and the median would all be identical, becasue there is only one data point. Of course we would assume that is probably not true in the population. We would assume that with a larger sample there would be more data points with low predicted values and these would have some variability. Whether it is genuinely less variable than at higher predicted values or is really equal (or even more!) is not really possible to clearly tell, in this small sample size.</p>
<p>Essentially this would come down to some degree of judgement call, whether to treat this as meeting or violating the assumptions.</p>
<p>Something that you can do with these kind of cases, is to explore any modifications (e.g., transformations to outcomes / predictors), excluding outliers / extreme values, adding / removing predictors, exploring some non-linear associations, etc. When or if you try any of these, you can examine whether that seems to have helped or improved the model diagnostics, and equally whether your results or findings have changed.</p>
<div class="cell" data-fig.fullwidth="true">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">modelDiagnostics</span>(r5, <span class="at">quantiles =</span> <span class="cn">FALSE</span>), <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interpretting_residual_diagnostics_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption>miles per gallon, no quantiles.</figcaption>
</figure>
</div>
</div>
</div>
<p>Here are some examples. First, it seemed that residuals may be a bit higher for both low and high predicted values. That may suggest some non-linear association between predictors and outcome. We can check for linear + quadratic associations, using the <code>poly()</code> function. This will add a quadratic term to the model, and we can see if that helps.</p>
<div class="cell" data-fig.fullwidth="true">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>r5b <span class="ot">&lt;-</span> <span class="fu">lm</span>(mpg <span class="sc">~</span> <span class="fu">poly</span>(hp, <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">poly</span>(qsec, <span class="dv">2</span>), <span class="at">data =</span> mtcars)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">modelDiagnostics</span>(r5b), <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interpretting_residual_diagnostics_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption>miles per gallon with quadratic associations.</figcaption>
</figure>
</div>
</div>
</div>
<p>The initial model residuals had some higher values, potentially suggesting a bit of a longer right tail. Not very extreme, but something that may be worth checking. We can try some transformations of the outcome, like square root.</p>
<div class="cell" data-fig.fullwidth="true">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>r5c <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">sqrt</span>(mpg) <span class="sc">~</span> hp <span class="sc">+</span> qsec, <span class="at">data =</span> mtcars)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">modelDiagnostics</span>(r5c), <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interpretting_residual_diagnostics_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption>square root miles per gallon.</figcaption>
</figure>
</div>
</div>
</div>
<p>We also try a log transform. The right hand side is brought in a bit. The residuals look a bit more symmetric maybe. The predicted versus residuals plot is not much changed.</p>
<div class="cell" data-fig.fullwidth="true">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>r5d <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(mpg) <span class="sc">~</span> hp <span class="sc">+</span> qsec, <span class="at">data =</span> mtcars)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">modelDiagnostics</span>(r5d), <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interpretting_residual_diagnostics_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption>log miles per gallon.</figcaption>
</figure>
</div>
</div>
</div>
<p>Finally, we could try both transforms and non linear associations. At this point, actually it looks fairly normal residuals and the predicted versus residuals look pretty flat and with no clear pattern.</p>
<div class="cell" data-fig.fullwidth="true">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>r5e <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(mpg) <span class="sc">~</span> <span class="fu">poly</span>(hp, <span class="dv">2</span>) <span class="sc">+</span> <span class="fu">poly</span>(qsec, <span class="dv">2</span>), <span class="at">data =</span> mtcars)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="fu">modelDiagnostics</span>(r5e), <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="interpretting_residual_diagnostics_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="864"></p>
<figcaption>log miles per gallon.</figcaption>
</figure>
</div>
</div>
</div>
<p>Finally we can compare the models to see how much results differ. We cannot directly compare the coefficients in this case because things like non linear associations and transformations change the scale. However, we can compare two things:</p>
<ol type="1">
<li>Model fit, like R2 or adjusted R2</li>
<li>Effect sizes for each predictor (f2)</li>
</ol>
<p>When we do that and look at all the different models we tried, we can see the biggest change is between linear <code>hp</code> and the linear + quadratic <code>hp</code> model. That effect sizes goes from f2 = 1.27 to &gt;3. We can also see that the adjusted R2 is highest in the model with a log transform of the outcome and linear + quadratric associations for both predictors.</p>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(<span class="fu">APAStyler</span>(<span class="fu">list</span>(</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>    <span class="at">Orig =</span> <span class="fu">modelTest</span>(r5),</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">Poly =</span> <span class="fu">modelTest</span>(r5b),</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Sqrt =</span> <span class="fu">modelTest</span>(r5c),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Log =</span> <span class="fu">modelTest</span>(r5d),</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">PolyLog =</span> <span class="fu">modelTest</span>(r5e))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<table class="caption-top table">
<colgroup>
<col style="width: 11%">
<col style="width: 15%">
<col style="width: 17%">
<col style="width: 15%">
<col style="width: 14%">
<col style="width: 15%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Term</th>
<th style="text-align: left;">Orig</th>
<th style="text-align: left;">Poly</th>
<th style="text-align: left;">Sqrt</th>
<th style="text-align: left;">Log</th>
<th style="text-align: left;">PolyLog</th>
<th style="text-align: left;">Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: left;">48.32*** [25.61, 71.03]</td>
<td style="text-align: left;">20.09*** [ 19.04, 21.14]</td>
<td style="text-align: left;">7.64*** [ 5.22, 10.06]</td>
<td style="text-align: left;">4.45*** [ 3.37, 5.52]</td>
<td style="text-align: left;">2.96*** [ 2.91, 3.01]</td>
<td style="text-align: left;">Fixed Effects</td>
</tr>
<tr class="even">
<td style="text-align: left;">hp</td>
<td style="text-align: left;">-0.08*** [-0.11, -0.06]</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.01*** [-0.01, -0.01]</td>
<td style="text-align: left;">0.00*** [-0.01, 0.00]</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Fixed Effects</td>
</tr>
<tr class="odd">
<td style="text-align: left;">qsec</td>
<td style="text-align: left;">-0.89 [-1.98, 0.21]</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.10 [-0.22, 0.01]</td>
<td style="text-align: left;">-0.05 [-0.10, 0.00]</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Fixed Effects</td>
</tr>
<tr class="even">
<td style="text-align: left;">poly(hp, 2)1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-34.61*** [-44.03, -25.20]</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-1.83*** [-2.28, -1.38]</td>
<td style="text-align: left;">Fixed Effects</td>
</tr>
<tr class="odd">
<td style="text-align: left;">poly(hp, 2)2</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">11.85*** [ 5.38, 18.32]</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.49** [ 0.18, 0.79]</td>
<td style="text-align: left;">Fixed Effects</td>
</tr>
<tr class="even">
<td style="text-align: left;">poly(qsec, 2)1</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-10.52* [-19.44, -1.61]</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">-0.61** [-1.03, -0.19]</td>
<td style="text-align: left;">Fixed Effects</td>
</tr>
<tr class="odd">
<td style="text-align: left;">poly(qsec, 2)2</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">3.72 [ -3.42, 10.86]</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">0.30 [-0.04, 0.64]</td>
<td style="text-align: left;">Fixed Effects</td>
</tr>
<tr class="even">
<td style="text-align: left;">N (Observations)</td>
<td style="text-align: left;">32</td>
<td style="text-align: left;">32</td>
<td style="text-align: left;">32</td>
<td style="text-align: left;">32</td>
<td style="text-align: left;">32</td>
<td style="text-align: left;">Overall Model</td>
</tr>
<tr class="odd">
<td style="text-align: left;">logLik DF</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">6</td>
<td style="text-align: left;">Overall Model</td>
</tr>
<tr class="even">
<td style="text-align: left;">logLik</td>
<td style="text-align: left;">-86.17</td>
<td style="text-align: left;">-76.62</td>
<td style="text-align: left;">-14.51</td>
<td style="text-align: left;">11.34</td>
<td style="text-align: left;">20.95</td>
<td style="text-align: left;">Overall Model</td>
</tr>
<tr class="odd">
<td style="text-align: left;">AIC</td>
<td style="text-align: left;">180.34</td>
<td style="text-align: left;">165.24</td>
<td style="text-align: left;">37.01</td>
<td style="text-align: left;">-14.68</td>
<td style="text-align: left;">-29.91</td>
<td style="text-align: left;">Overall Model</td>
</tr>
<tr class="even">
<td style="text-align: left;">BIC</td>
<td style="text-align: left;">186.20</td>
<td style="text-align: left;">174.04</td>
<td style="text-align: left;">42.87</td>
<td style="text-align: left;">-8.82</td>
<td style="text-align: left;">-21.11</td>
<td style="text-align: left;">Overall Model</td>
</tr>
<tr class="odd">
<td style="text-align: left;">F2</td>
<td style="text-align: left;">1.75</td>
<td style="text-align: left;">4.00</td>
<td style="text-align: left;">1.92</td>
<td style="text-align: left;">1.98</td>
<td style="text-align: left;">4.44</td>
<td style="text-align: left;">Overall Model</td>
</tr>
<tr class="even">
<td style="text-align: left;">R2</td>
<td style="text-align: left;">0.64</td>
<td style="text-align: left;">0.80</td>
<td style="text-align: left;">0.66</td>
<td style="text-align: left;">0.66</td>
<td style="text-align: left;">0.82</td>
<td style="text-align: left;">Overall Model</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Adj R2</td>
<td style="text-align: left;">0.61</td>
<td style="text-align: left;">0.77</td>
<td style="text-align: left;">0.63</td>
<td style="text-align: left;">0.64</td>
<td style="text-align: left;">0.79</td>
<td style="text-align: left;">Overall Model</td>
</tr>
<tr class="even">
<td style="text-align: left;">hp</td>
<td style="text-align: left;">f2 = 1.27, p &lt; .001</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">f2 = 1.41, p &lt; .001</td>
<td style="text-align: left;">f2 = 1.47, p &lt; .001</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Effect Sizes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">qsec</td>
<td style="text-align: left;">f2 = 0.09, p = .108</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">f2 = 0.11, p = .084</td>
<td style="text-align: left;">f2 = 0.12, p = .069</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">Effect Sizes</td>
</tr>
<tr class="even">
<td style="text-align: left;">poly(hp, 2)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">f2 = 3.10, p &lt; .001</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">f2 = 3.49, p &lt; .001</td>
<td style="text-align: left;">Effect Sizes</td>
</tr>
<tr class="odd">
<td style="text-align: left;">poly(qsec, 2)</td>
<td style="text-align: left;"></td>
<td style="text-align: left;">f2 = 0.22, p = .068</td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;">f2 = 0.35, p = .017</td>
<td style="text-align: left;">Effect Sizes</td>
</tr>
</tbody>
</table>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>